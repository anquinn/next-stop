function currentLocation(o){var t=o.coords.latitude,n=o.coords.longitude;console.log("current position is: "+t+", "+n),findClosest(t,n)}function handle_error(o){console.log("can't find location"),0===o.code&&console.log("unknown"),1===o.code&&console.log("denied"),2===o.code&&console.log("unreliable"),3===o.code&&console.log("taking ages")}function getLocation(){Modernizr.geolocation?(navigator.geolocation.getCurrentPosition(currentLocation,handle_error,{timeout:1e4}),console.log("browser has geolocation")):console.log("no geolocation available")}function findClosest(o,t){$.ajax({url:"assets/json/stops.json",dataType:"json",success:function(n){for(var s=50,e=0,a=0,i=6371,l=0,c=o.toRad(),r=0,d=0,g=0,u=null,p=0;p<n.length;p++)e=(o-n[p].stop_lat).toRad(),a=(t-n[p].stop_lon).toRad(),l=n[p].stop_lat.toRad(),c=o.toRad(),r=Math.sin(e/2)*Math.sin(e/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(l)*Math.cos(c),d=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)),g=i*d,s>g&&(s=g,u=n[p]);console.log(u.stop_code),console.log(u.stop_name),$("#closest-stop").html(u.stop_name),getBusList(u,n)},error:function(){alert("failed!")}})}function crossWithStopTime(o){$.ajax({url:"assets/json/stop_times.json",dataType:"json",success:function(t){var n=0,s=0;for(n=0;n<o.length;n++)for(s=0;s<t.length;s++)o[n].stop_id===t[s].stop_id&&(console.log("stop id: "+t[s].stop_id),console.log("arrival time: "+t[s].arrival_time))},error:function(){console.log("Error")}}),console.log("done")}function getBusList(o,t){var n=[],s=0,e=0;for(s=0;s<t.length;s++)o.stop_id===t[s].stop_id&&(n[e]=t[s],console.log(n[e].stop_id));crossWithStopTime(n)}$(document).ready(function(){getLocation()}),Number.prototype.toRad=function(){return this*Math.PI/180};