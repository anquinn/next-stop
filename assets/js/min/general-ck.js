function currentLocation(o){var t=o.coords.latitude,n=o.coords.longitude;console.log("current position is: "+t+", "+n),findClosest(t,n)}function handle_error(o){console.log("can't find location"),0===o.code&&console.log("unknown"),1===o.code&&console.log("denied"),2===o.code&&console.log("unreliable"),3===o.code&&console.log("taking ages")}function getLocation(){Modernizr.geolocation?(navigator.geolocation.getCurrentPosition(currentLocation,handle_error,{timeout:1e4}),console.log("browser has geolocation")):console.log("no geolocation available")}function findClosest(o,t){$.ajax({url:"assets/json/stops.json",dataType:"json",success:function(n){var e=50,a=0,s=0,l=6371,c=0,r=o.toRad(),d=0,u=0,g=0,h=null;for(i=0;i<n.length;i++)a=(o-n[i].stop_lat).toRad(),s=(t-n[i].stop_lon).toRad(),c=n[i].stop_lat.toRad(),r=o.toRad(),d=Math.sin(a/2)*Math.sin(a/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(c)*Math.cos(r),u=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),g=l*u,e>g&&(e=g,h=n[i]);console.log(h.stop_code),console.log(h.stop_name),$("#closest-stop").html(h.stop_name)},error:function(){alert("failed!")}})}$(document).ready(function(){getLocation()}),Number.prototype.toRad=function(){return this*Math.PI/180};